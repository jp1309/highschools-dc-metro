<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Schools del √Årea Metropolitana de Washington DC - Calificaciones</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }


        .info-panel {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            max-width: 300px;
        }

        .info-panel h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .info-panel p {
            font-size: 13px;
            color: #666;
            margin: 5px 0;
        }

        .leaflet-popup-content {
            margin: 10px 15px;
        }

        .popup-title {
            font-weight: bold;
            font-size: 15px;
            color: #333;
            margin-bottom: 8px;
        }

        .popup-rating {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .popup-address {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .popup-jurisdiction {
            font-size: 11px;
            color: #888;
            font-style: italic;
        }


        .stats-panel {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            color: #555;
        }

        #loading-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            font-family: Arial, sans-serif;
            font-size: 14px;
            max-width: 300px;
        }

        #loading-status.success {
            border-left: 4px solid #1a9850;
        }

        #loading-status.error {
            border-left: 4px solid #d73027;
        }

        #loading-status .status-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        #loading-status .status-details {
            font-size: 12px;
            color: #666;
            line-height: 1.6;
        }

        /* Estilos para la leyenda */
        .legend {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            line-height: 18px;
            color: #333;
            font-size: 12px;
            min-width: 110px;
        }

        .legend i {
            width: 16px;
            height: 16px;
            float: left;
            margin-right: 10px;
            opacity: 0.9;
            border-radius: 3px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 13px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="loading-status">
        <div class="status-title">‚è≥ Cargando boundaries...</div>
        <div class="status-details">Esperando datos GeoJSON</div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // ============================================
        // DATOS DE HIGH SCHOOLS
        // √öltima actualizaci√≥n: Enero 2026
        // Fuente: GreatSchools.org
        // ============================================

        const highSchools = [
            // ==================== ARLINGTON, VA ====================
            {
                name: "Yorktown High School",
                address: "5200 Yorktown Boulevard, Arlington, VA 22207",
                rating: 9,
                lat: 38.9089,
                lng: -77.1342,
                jurisdiction: "Arlington, VA"
            },
            {
                name: "Washington-Liberty High School",
                address: "1301 North Stafford Street, Arlington, VA 22201",
                rating: 6,
                lat: 38.8887,
                lng: -77.0942,
                jurisdiction: "Arlington, VA"
            },
            {
                name: "Wakefield High School",
                address: "1325 S. Dinwiddie Street, Arlington, VA 22206",
                rating: 4,
                lat: 38.8422,
                lng: -77.0856,
                jurisdiction: "Arlington, VA"
            },

            // ==================== FAIRFAX COUNTY, VA ====================
            // NOTA: Thomas Jefferson HS eliminado - es escuela magnet sin attendance zone
            {
                name: "Langley High School",
                address: "6520 Georgetown Pike, McLean, VA 22101",
                rating: 9,
                lat: 38.9406,
                lng: -77.1881,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "McLean High School",
                address: "1633 Davidson Road, McLean, VA 22101",
                rating: 9,
                lat: 38.9312,
                lng: -77.1775,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Woodson High School",
                address: "9525 Main St, Fairfax, VA 22031",
                rating: 9,
                lat: 38.8561,
                lng: -77.2864,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "West Springfield High School",
                address: "6100 Rolling Road, Springfield, VA 22152",
                rating: 9,
                lat: 38.7689,
                lng: -77.2022,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Madison High School",
                address: "2500 James Madison Drive, Vienna, VA 22181",
                rating: 8,
                lat: 38.9017,
                lng: -77.2586,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Oakton High School",
                address: "2900 Sutton Road, Vienna, VA 22181",
                rating: 8,
                lat: 38.8792,
                lng: -77.3103,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Lake Braddock Secondary",
                address: "9200 Burke Lake Road, Burke, VA 22015",
                rating: 8,
                lat: 38.7900,
                lng: -77.2756,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Chantilly High School",
                address: "4201 Stringfellow Road, Chantilly, VA 20151",
                rating: 8,
                lat: 38.8767,
                lng: -77.4225,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Robinson Secondary",
                address: "5035 Sideburn Road, Fairfax, VA 22032",
                rating: 7,
                lat: 38.8242,
                lng: -77.3069,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Marshall High School",
                address: "7731 Leesburg Pike, Falls Church, VA 22043",
                rating: 7,
                lat: 38.9097,
                lng: -77.2147,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "South County High School",
                address: "8501 Silverbrook Road, Lorton, VA 22079",
                rating: 7,
                lat: 38.6967,
                lng: -77.2217,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Fairfax High School",
                address: "3501 Lion Run, Fairfax, VA 22030",
                rating: 6,
                lat: 38.8586,
                lng: -77.3169,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "South Lakes High School",
                address: "11400 South Lakes Drive, Reston, VA 20191",
                rating: 6,
                lat: 38.9311,
                lng: -77.3606,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Westfield High School",
                address: "4700 Stonecroft Boulevard, Chantilly, VA 20151",
                rating: 6,
                lat: 38.8533,
                lng: -77.4378,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Hayfield Secondary",
                address: "7630 Telegraph Road, Alexandria, VA 22315",
                rating: 6,
                lat: 38.7539,
                lng: -77.1208,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "West Potomac High School",
                address: "6500 Quander Road, Alexandria, VA 22307",
                rating: 5,
                lat: 38.7592,
                lng: -77.0717,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "John R. Lewis High School",
                address: "6540 Franconia Road, Springfield, VA 22150",
                rating: 4,
                lat: 38.7814,
                lng: -77.1394,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Edison High School",
                address: "5801 Franconia Road, Alexandria, VA 22310",
                rating: 4,
                lat: 38.7975,
                lng: -77.1297,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Herndon High School",
                address: "700 Bennett Street, Herndon, VA 20170",
                rating: 3,
                lat: 38.9647,
                lng: -77.3864,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Annandale High School",
                address: "4700 Medford Drive, Annandale, VA 22003",
                rating: 3,
                lat: 38.8308,
                lng: -77.2044,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Mount Vernon High School",
                address: "8515 Old Mount Vernon Road, Alexandria, VA 22309",
                rating: 2,
                lat: 38.7156,
                lng: -77.0886,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Falls Church High School",
                address: "7521 Jaguar Trail, Falls Church, VA 22042",
                rating: 2,
                lat: 38.8672,
                lng: -77.1756,
                jurisdiction: "Fairfax County, VA"
            },
            {
                name: "Justice High School",
                address: "3301 Peace Valley Lane, Falls Church, VA 22044",
                rating: 2,
                lat: 38.8539,
                lng: -77.1594,
                jurisdiction: "Fairfax County, VA"
            },

            // ==================== FALLS CHURCH CITY, VA ====================
            {
                name: "Meridian High School",
                address: "121 Mustang Alley, Falls Church, VA 22043",
                rating: 9,
                lat: 38.8917,
                lng: -77.1711,
                jurisdiction: "Falls Church City, VA"
            },

            // ==================== ALEXANDRIA CITY, VA ====================
            {
                name: "Alexandria City High School",
                address: "3330 King Street, Alexandria, VA 22302",
                rating: 4,
                lat: 38.8178,
                lng: -77.0856,
                jurisdiction: "Alexandria City, VA"
            },

            // ==================== MONTGOMERY COUNTY, MD ====================
            {
                name: "Thomas S. Wootton High School",
                address: "2100 Wootton Parkway, Rockville, MD 20850",
                rating: 10,
                lat: 39.1089,
                lng: -77.1889,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Walt Whitman High School",
                address: "7100 Whittier Boulevard, Bethesda, MD 20817",
                rating: 9,
                lat: 38.9767,
                lng: -77.1278,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Winston Churchill High School",
                address: "11300 Gainsborough Rd, Potomac, MD 20854",
                rating: 8,
                lat: 39.0539,
                lng: -77.1703,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Walter Johnson High School",
                address: "6400 Rock Spring Dr, Bethesda, MD 20814",
                rating: 9,
                lat: 39.0092,
                lng: -77.1044,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Richard Montgomery High School",
                address: "250 Richard Montgomery Drive, Rockville, MD 20852",
                rating: 8,
                lat: 39.0628,
                lng: -77.1231,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Bethesda-Chevy Chase High School",
                address: "4301 East-West Highway, Bethesda, MD 20814",
                rating: 8,
                lat: 38.9903,
                lng: -77.0758,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Montgomery Blair High School",
                address: "51 University Boulevard East, Silver Spring, MD 20901",
                rating: 7,
                lat: 38.9950,
                lng: -77.0097,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Northwood High School",
                address: "919 University Boulevard West, Silver Spring, MD 20901",
                rating: 7,
                lat: 39.0036,
                lng: -77.0247,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "James Hubert Blake High School",
                address: "300 Norwood Road, Silver Spring, MD 20905",
                rating: 6,
                lat: 39.1047,
                lng: -76.9831,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Rockville High School",
                address: "2100 Baltimore Road, Rockville, MD 20851",
                rating: 6,
                lat: 39.0708,
                lng: -77.1439,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Col. Zadok Magruder High School",
                address: "5939 Muncaster Mill Rd, Rockville, MD 20855",
                rating: 7,
                lat: 39.1331,
                lng: -77.1450,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "John F. Kennedy High School",
                address: "1901 Randolph Rd, Silver Spring, MD 20902",
                rating: 4,
                lat: 39.0258,
                lng: -77.0431,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Springbrook High School",
                address: "201 Valley Brook Dr, Silver Spring, MD 20904",
                rating: 4,
                lat: 39.0628,
                lng: -76.9858,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Northwest High School",
                address: "13501 Richter Farm Road, Germantown, MD 20874",
                rating: 7,
                lat: 39.1726,
                lng: -77.2527,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Gaithersburg High School",
                address: "101 Education Boulevard, Gaithersburg, MD 20877",
                rating: 3,
                lat: 39.1437,
                lng: -77.2108,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Sherwood High School",
                address: "300 Olney-Sandy Spring Road, Sandy Spring, MD 20860",
                rating: 6,
                lat: 39.1344,
                lng: -77.0061,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Wheaton High School",
                address: "12401 Dalewood Drive, Silver Spring, MD 20906",
                rating: 5,
                lat: 39.0598,
                lng: -77.0672,
                jurisdiction: "Montgomery County, MD"
            },
            {
                name: "Albert Einstein High School",
                address: "11135 Newport Mill Rd, Kensington, MD 20895",
                rating: 7,
                lat: 39.0236,
                lng: -77.0526,
                jurisdiction: "Montgomery County, MD"
            },

            // ==================== PRINCE GEORGE'S COUNTY, MD ====================
            {
                name: "Eleanor Roosevelt High School",
                address: "7601 Hanover Parkway, Greenbelt, MD 20770",
                rating: 7,
                lat: 38.998813,
                lng: -76.875762,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Frederick Douglass High School",
                address: "8000 Croom Road, Upper Marlboro, MD 20772",
                rating: 5,
                lat: 38.754365,
                lng: -76.757218,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Bowie High School",
                address: "15200 Annapolis Road, Bowie, MD 20715",
                rating: 4,
                lat: 38.978385,
                lng: -76.728084,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Dr. Henry A. Wise Jr. High School",
                address: "12650 Brooke Lane, Upper Marlboro, MD 20772",
                rating: 3,
                lat: 38.813933,
                lng: -76.776038,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Largo High School",
                address: "505 Largo Road, Upper Marlboro, MD 20774",
                rating: 3,
                lat: 38.877567,
                lng: -76.818345,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Northwestern High School",
                address: "7000 Adelphi Road, Hyattsville, MD 20782",
                rating: 2,
                lat: 38.970691,
                lng: -76.960852,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Bladensburg High School",
                address: "4301 57th Avenue, Bladensburg, MD 20710",
                rating: 1,
                lat: 38.941577,
                lng: -76.91458,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Central High School",
                address: "200 Dodge Park Road, Capitol Heights, MD 20743",
                rating: 2,
                lat: 38.889054,
                lng: -76.892276,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Charles Herbert Flowers High School",
                address: "10001 Ardwick Ardmore Road, Springdale, MD 20774",
                rating: 5,
                lat: 38.920347,
                lng: -76.829583,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Crossland High School",
                address: "6901 Allentown Road, Temple Hills, MD 20748",
                rating: 2,
                lat: 38.792637,
                lng: -76.931953,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Duval High School",
                address: "9880 Good Luck Road, Lanham, MD 20706",
                rating: 3,
                lat: 38.968247,
                lng: -76.842216,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Fairmont Heights High School",
                address: "5811 Columbia Park Road, Landover, MD 20785",
                rating: 2,
                lat: 38.90974,
                lng: -76.896628,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Friendly High School",
                address: "10000 Allentown Road, Fort Washington, MD 20744",
                rating: 2,
                lat: 38.73976,
                lng: -76.985583,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Gwynn Park High School",
                address: "13800 Brandywine Road, Brandywine, MD 20613",
                rating: 3,
                lat: 38.661598,
                lng: -76.857419,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "High Point High School",
                address: "3601 Powder Mill Road, Beltsville, MD 20705",
                rating: 2,
                lat: 39.012078,
                lng: -76.953775,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Laurel High School",
                address: "8000 Cherry Lane, Laurel, MD 20707",
                rating: 2,
                lat: 39.084146,
                lng: -76.842053,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Oxon Hill High School",
                address: "6701 Leyte Drive, Oxon Hill, MD 20745",
                rating: 4,
                lat: 38.781324,
                lng: -76.991476,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Parkdale High School",
                address: "6001 Good Luck Road, Riverdale, MD 20737",
                rating: 2,
                lat: 38.970337,
                lng: -76.90415,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Potomac High School",
                address: "5211 Boydell Avenue, Oxon Hill, MD 20745",
                rating: 1,
                lat: 38.824749,
                lng: -76.972237,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Suitland High School",
                address: "5200 Silver Hill Road, Suitland, MD 20746",
                rating: 2,
                lat: 38.85982,
                lng: -76.903745,
                jurisdiction: "Prince George's County, MD"
            },
            {
                name: "Surrattsville High School",
                address: "6101 Garden Drive, Clinton, MD 20735",
                rating: 2,
                lat: 38.737929,
                lng: -76.893017,
                jurisdiction: "Prince George's County, MD"
            },

            // ==================== WASHINGTON, DC ====================
            // NOTA: Solo escuelas con boundaries oficiales en DC.geojson (10 escuelas)
            // Eliminadas: Benjamin Banneker, School Without Walls, McKinley Tech,
            // Phelps, Duke Ellington, Columbia Heights, Ron Brown, Bard (escuelas magnet/especiales)
            {
                name: "Jackson-Reed High School",
                address: "3950 Chesapeake Street NW, Washington, DC 20016",
                rating: 7,
                lat: 38.9511,
                lng: -77.0789,
                jurisdiction: "Washington, DC"
            },
            {
                name: "H.D. Woodson High School",
                address: "540 55th Street NE, Washington, DC 20019",
                rating: 4,
                lat: 38.8983,
                lng: -76.9231,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Coolidge High School",
                address: "6315 5th Street NW, Washington, DC 20011",
                rating: 4,
                lat: 38.9608,
                lng: -77.0242,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Roosevelt High School",
                address: "4301 13th Street NW, Washington, DC 20011",
                rating: 1,
                lat: 38.9428,
                lng: -77.0317,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Dunbar High School",
                address: "101 N Street NW, Washington, DC 20001",
                rating: 3,
                lat: 38.9078,
                lng: -77.0122,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Eastern High School",
                address: "1700 East Capitol Street SE, Washington, DC 20003",
                rating: 2,
                lat: 38.8889,
                lng: -76.9806,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Cardozo Education Campus",
                address: "1200 Clifton Street NW, Washington, DC 20009",
                rating: 2,
                lat: 38.9267,
                lng: -77.0283,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Ballou High School",
                address: "3401 4th Street SE, Washington, DC 20032",
                rating: 2,
                lat: 38.8383,
                lng: -76.9939,
                jurisdiction: "Washington, DC"
            },
            {
                name: "Anacostia High School",
                address: "1601 16th Street SE, Washington, DC 20020",
                rating: 4,
                lat: 38.8639,
                lng: -76.9806,
                jurisdiction: "Washington, DC"
            },
            {
                name: "MacArthur High School",
                address: "4530 MacArthur Boulevard NW, Washington, DC 20007",
                rating: 2,
                lat: 38.9267,
                lng: -77.1044,
                jurisdiction: "Washington, DC"
            }
        ];

        // ============================================
        // FUNCIONES DE UTILIDAD
        // ============================================

        // Obtener color seg√∫n calificaci√≥n (usando la escala de 10 niveles)
        function getRatingColor(rating) {
            // Nota: ratingColors se define m√°s adelante pero esta funci√≥n se llama
            // despu√©s de que el script se ha cargado completamente.
            return ratingColors[rating] || '#999';
        }

        // Obtener descripci√≥n de calificaci√≥n
        function getRatingDescription(rating) {
            if (rating <= 2) return 'Muy por debajo del promedio';
            if (rating <= 4) return 'Por debajo del promedio';
            if (rating <= 6) return 'Promedio';
            if (rating <= 8) return 'Por encima del promedio';
            return 'Excelente';
        }

        // Crear pol√≠gono aproximado (hex√°gono) alrededor de una escuela
        function createSchoolZone(lat, lng, radiusKm = 2.5) {
            const points = [];
            const numSides = 6;

            for (let i = 0; i < numSides; i++) {
                const angle = (i * 2 * Math.PI / numSides) - Math.PI / 2;
                // A√±adir peque√±a variaci√≥n para que no se vean todos iguales
                const variation = 0.85 + Math.random() * 0.3;
                const latOffset = (radiusKm * variation / 111) * Math.cos(angle);
                const lngOffset = (radiusKm * variation / (111 * Math.cos(lat * Math.PI / 180))) * Math.sin(angle);
                points.push([lat + latOffset, lng + lngOffset]);
            }

            return points;
        }

        // ============================================
        // INICIALIZACI√ìN DEL MAPA
        // ============================================

        // Crear mapa centrado en Washington DC
        const map = L.map('map').setView([38.9072, -77.0369], 10);

        // A√±adir capa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Grupos de capas para filtrado
        const jurisdictionLayers = {};
        const allSchoolsLayer = L.layerGroup().addTo(map);

        // Rastrear qu√© escuelas tienen boundaries oficiales
        const schoolsWithOfficialBoundaries = new Set();

        // Map para relacionar marcadores con sus pol√≠gonos
        const markerToPolygonMap = new Map();
        let currentHighlightedPolygon = null;

        // Funci√≥n para crear pol√≠gonos aproximados (se llamar√° despu√©s de cargar boundaries)
        function createApproximateZones() {
            highSchools.forEach(school => {
                // Solo crear hex√°gonos para escuelas SIN boundaries oficiales
                if (schoolsWithOfficialBoundaries.has(school.name.toLowerCase())) {
                    console.log(`Omitiendo hex√°gono para ${school.name} (tiene boundary oficial)`);
                    return;
                }

                const color = getRatingColor(school.rating);

                // Crear pol√≠gono de zona aproximada
                const zoneCoords = createSchoolZone(school.lat, school.lng);
                const zone = L.polygon(zoneCoords, {
                    color: color,
                    weight: 2,
                    opacity: 0.4,
                    fillColor: color,
                    fillOpacity: 0.2,
                    dashArray: '5, 5' // L√≠nea punteada para distinguir de boundaries oficiales
                });

                // Crear marcador en el centro
                const marker = L.circleMarker([school.lat, school.lng], {
                    radius: 6,
                    fillColor: color,
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 1,
                    pane: 'markerPane'
                });

                // Contenido del popup
                const popupContent = `
                    <div class="popup-title">${school.name}</div>
                    <div class="popup-rating" style="background-color: ${color}">
                        ${school.rating}/10
                    </div>
                    <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                        ${getRatingDescription(school.rating)}
                    </div>
                    <div class="popup-address">üìç ${school.address}</div>
                    <div class="popup-jurisdiction">üèõÔ∏è ${school.jurisdiction}</div>
                    <div style="margin-top: 5px; font-size: 10px; color: #ff9800;">
                        ‚ö† Zona aproximada (no oficial)
                    </div>
                `;

                zone.bindPopup(popupContent);
                marker.bindPopup(popupContent);

                // A√±adir a capa general
                zone.addTo(allSchoolsLayer);
                marker.addTo(allSchoolsLayer);

                // Organizar por jurisdicci√≥n
                if (!jurisdictionLayers[school.jurisdiction]) {
                    jurisdictionLayers[school.jurisdiction] = L.layerGroup();
                }
                jurisdictionLayers[school.jurisdiction].addLayer(zone);
                jurisdictionLayers[school.jurisdiction].addLayer(marker);
            });
        }

        // Colores por rating (6 rangos: 10, 8-9, 6-7, 4-5, 2-3, 1)
        const ratingColors = {
            1: '#d73027',   // Rojo intenso
            2: '#fc8d59',   // Rojo-naranja
            3: '#fc8d59',   // Rojo-naranja
            4: '#fee08b',   // Amarillo-naranja
            5: '#fee08b',   // Amarillo-naranja
            6: '#d9ef8b',   // Amarillo-verde
            7: '#d9ef8b',   // Amarillo-verde
            8: '#91cf60',   // Verde claro
            9: '#91cf60',   // Verde claro
            10: '#1a9850'   // Verde fuerte
        };

        // ============================================
        // CONTROLES
        // ============================================


        // Leyenda de colores (6 rangos)
        const legend = L.control({ position: 'bottomright' });
        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            const ranges = [
                { range: '10', color: ratingColors[10], label: '10 (Excelente)' },
                { range: '8-9', color: ratingColors[9], label: '8-9' },
                { range: '6-7', color: ratingColors[7], label: '6-7' },
                { range: '4-5', color: ratingColors[5], label: '4-5' },
                { range: '2-3', color: ratingColors[3], label: '2-3' },
                { range: '1', color: ratingColors[1], label: '1 (Muy bajo)' }
            ];

            div.innerHTML = '<div class="legend-title">Calificaci√≥n GS</div>';

            for (let i = 0; i < ranges.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + ranges[i].color + '"></i> ' +
                    ranges[i].label + '<br>';
            }

            return div;
        };
        legend.addTo(map);


        // ============================================
        // EVENT LISTENER PARA DESRESALTAR AL HACER CLICK EN EL MAPA
        // ============================================

        map.on('click', function (e) {
            // Verificar que no se hizo click en un marcador
            // Si hay un pol√≠gono resaltado, restaurarlo
            if (currentHighlightedPolygon) {
                const prevColor = currentHighlightedPolygon._originalColor || '#999';
                currentHighlightedPolygon.setStyle({
                    fillOpacity: 0.5,
                    weight: 3,
                    opacity: 1,
                    color: prevColor,
                    fillColor: prevColor
                });
                currentHighlightedPolygon = null;
            }
        });


        // ============================================
        // CARGA DE BOUNDARIES REALES
        // ============================================

        const boundaryFiles = [
            "fairfax_hs_boundaries.geojson",
            "montgomery_hs_boundaries.geojson",
            "arlington_hs_boundaries.geojson",
            "princegeorge_hs_boundaries.geojson",
            "Alexandria.geojson",
            "DC.geojson"
        ];

        // Funci√≥n para resaltar un pol√≠gono
        function highlightPolygon(polygon, color) {
            if (currentHighlightedPolygon && currentHighlightedPolygon !== polygon) {
                // Restaurar el pol√≠gono anterior
                const prevColor = currentHighlightedPolygon._originalColor || '#999';
                currentHighlightedPolygon.setStyle({
                    fillOpacity: 0.5,
                    weight: 3,
                    opacity: 1,
                    color: prevColor,
                    fillColor: prevColor
                });
            }

            // Guardar color original si no existe
            if (!polygon._originalColor) {
                polygon._originalColor = color;
            }

            // Resaltar el nuevo pol√≠gono
            polygon.setStyle({
                fillOpacity: 0.8,
                weight: 5,
                opacity: 1,
                color: '#000',
                fillColor: color
            });

            currentHighlightedPolygon = polygon;

            // Hacer zoom al pol√≠gono
            map.fitBounds(polygon.getBounds(), {
                padding: [50, 50],
                maxZoom: 13
            });
        }

        // Funcion para encontrar rating de escuela por nombre
        function findSchoolRating(schoolName) {
            if (!schoolName) return null;

            const schoolNameLower = schoolName.toLowerCase()
                .replace(' high school', '')
                .replace(' hs', '')
                .trim();

            for (const school of highSchools) {
                const baseSchoolName = school.name.toLowerCase()
                    .replace(' high school', '')
                    .replace(' secondary', '')
                    .replace(' hs', '')
                    .trim();

                // Coincidencia exacta o parcial
                if (baseSchoolName === schoolNameLower ||
                    baseSchoolName.includes(schoolNameLower) ||
                    schoolNameLower.includes(baseSchoolName)) {
                    return school;
                }
            }
            return null;
        }

        // Cargar cada archivo de boundaries
        async function loadBoundaries() {
            const statusDiv = document.getElementById('loading-status');
            const statusTitle = statusDiv.querySelector('.status-title');
            const statusDetails = statusDiv.querySelector('.status-details');

            console.log('Cargando boundaries oficiales...');
            let totalBoundariesLoaded = 0;
            let filesLoaded = 0;
            let filesFailed = 0;

            for (const file of boundaryFiles) {
                try {
                    statusDetails.innerHTML = `Cargando ${file}...`;
                    const response = await fetch(file);
                    if (!response.ok) {
                        console.warn(`No se pudo cargar ${file}: HTTP ${response.status}`);
                        filesFailed++;
                        continue;
                    }

                    const data = await response.json();
                    let boundariesInFile = 0;

                    // Casos especiales: Alexandria y DC
                    const isAlexandria = file === 'Alexandria.geojson';
                    const isDC = file === 'DC.geojson';

                    if (isAlexandria) {
                        // Para Alexandria: un solo pol√≠gono para ACHS (toda la ciudad)
                        const alexandriaSchool = highSchools.find(s =>
                            s.jurisdiction === 'Alexandria City, VA'
                        );

                        console.log('Procesando Alexandria:', alexandriaSchool ? alexandriaSchool.name : 'No encontrada');

                        if (alexandriaSchool && data.features && data.features.length > 0) {
                            const color = ratingColors[alexandriaSchool.rating];
                            console.log('Alexandria color:', color, 'rating:', alexandriaSchool.rating);

                            // Crear el pol√≠gono usando L.geoJSON
                            const geoJsonLayer = L.geoJSON(data, {
                                style: {
                                    fillColor: color,
                                    weight: 3,
                                    opacity: 1,
                                    color: color,
                                    fillOpacity: 0.5
                                }
                            }).addTo(allSchoolsLayer);

                            // Obtener el layer del pol√≠gono
                            const polygonLayer = geoJsonLayer.getLayers()[0];
                            if (polygonLayer) {
                                polygonLayer._originalColor = color;

                                // Usar coordenadas de la escuela del array
                                const marker = L.circleMarker([alexandriaSchool.lat, alexandriaSchool.lng], {
                                    radius: 8,
                                    fillColor: color,
                                    color: '#fff',
                                    weight: 3,
                                    opacity: 1,
                                    fillOpacity: 1,
                                    pane: 'markerPane'
                                });

                                const popupContent = `
                                    <div class="popup-title">${alexandriaSchool.name}</div>
                                    <div class="popup-rating" style="background-color: ${color}">
                                        ${alexandriaSchool.rating}/10
                                    </div>
                                    <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                                        ${getRatingDescription(alexandriaSchool.rating)}
                                    </div>
                                    <div class="popup-address">üìç ${alexandriaSchool.address}</div>
                                    <div class="popup-jurisdiction">üèõÔ∏è ${alexandriaSchool.jurisdiction}</div>
                                    <div style="margin-top: 5px; font-size: 10px; color: #1a9850; font-weight: bold;">
                                        ‚úì Boundary oficial (ciudad completa)
                                    </div>
                                `;

                                polygonLayer.bindPopup(popupContent);
                                marker.bindPopup(popupContent);

                                markerToPolygonMap.set(marker, polygonLayer);

                                // Resaltar cuando se hace click en el marcador
                                marker.on('click', function () {
                                    highlightPolygon(polygonLayer, color);
                                });

                                marker.addTo(allSchoolsLayer);
                                schoolsWithOfficialBoundaries.add(alexandriaSchool.name.toLowerCase());
                                boundariesInFile = 1;
                                console.log('Alexandria boundary agregado correctamente');
                            }
                        }
                    } else if (isDC) {
                        // Para DC: cada feature tiene una escuela espec√≠fica
                        // Hacer matching entre features del GeoJSON y escuelas del array
                        console.log('Procesando DC con', data.features.length, 'zonas');

                        const dcSchools = highSchools.filter(s =>
                            s.jurisdiction === 'Washington, DC'
                        );

                        // Funci√≥n para normalizar nombres de escuelas
                        function normalizeDCName(name) {
                            return name.toLowerCase()
                                .replace(' high school', '')
                                .replace(' education campus', '')
                                .replace(' at macfarland', '')
                                .replace('h.d. ', '')
                                .replace('hd ', '')
                                .trim();
                        }

                        // Procesar cada feature del GeoJSON de DC
                        data.features.forEach(feature => {
                            const zoneName = feature.properties.NAME || '';
                            const zoneNameNorm = normalizeDCName(zoneName);

                            // Buscar escuela que coincida con esta zona
                            const matchingSchool = dcSchools.find(school => {
                                const schoolNameNorm = normalizeDCName(school.name);
                                return schoolNameNorm.includes(zoneNameNorm) ||
                                    zoneNameNorm.includes(schoolNameNorm) ||
                                    schoolNameNorm === zoneNameNorm;
                            });

                            if (matchingSchool) {
                                const color = ratingColors[matchingSchool.rating];
                                console.log(`DC Match: ${zoneName} -> ${matchingSchool.name} (${matchingSchool.rating})`);

                                const geoJsonLayer = L.geoJSON(feature, {
                                    style: {
                                        fillColor: color,
                                        weight: 3,
                                        opacity: 1,
                                        color: color,
                                        fillOpacity: 0.5
                                    }
                                }).addTo(allSchoolsLayer);

                                const polygonLayer = geoJsonLayer.getLayers()[0];
                                if (polygonLayer) {
                                    polygonLayer._originalColor = color;

                                    // Usar coordenadas de la escuela del array
                                    const marker = L.circleMarker([matchingSchool.lat, matchingSchool.lng], {
                                        radius: 8,
                                        fillColor: color,
                                        color: '#fff',
                                        weight: 3,
                                        opacity: 1,
                                        fillOpacity: 1,
                                        pane: 'markerPane'
                                    });

                                    const popupContent = `
                                        <div class="popup-title">${matchingSchool.name}</div>
                                        <div class="popup-rating" style="background-color: ${color}">
                                            ${matchingSchool.rating}/10
                                        </div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                                            ${getRatingDescription(matchingSchool.rating)}
                                        </div>
                                        <div class="popup-address">üìç ${matchingSchool.address}</div>
                                        <div class="popup-jurisdiction">üèõÔ∏è ${matchingSchool.jurisdiction}</div>
                                        <div style="margin-top: 5px; font-size: 10px; color: #1a9850; font-weight: bold;">
                                            ‚úì Boundary oficial de attendance zone
                                        </div>
                                    `;

                                    polygonLayer.bindPopup(popupContent);
                                    marker.bindPopup(popupContent);

                                    markerToPolygonMap.set(marker, polygonLayer);

                                    // Resaltar cuando se hace click en el marcador
                                    marker.on('click', function () {
                                        highlightPolygon(polygonLayer, color);
                                    });

                                    marker.addTo(allSchoolsLayer);
                                    schoolsWithOfficialBoundaries.add(matchingSchool.name.toLowerCase());
                                    boundariesInFile++;
                                }
                            } else {
                                console.log(`DC Sin match para zona: ${zoneName}`);
                            }
                        });
                    } else {
                        // Archivos normales (Fairfax, Montgomery, Arlington)
                        L.geoJSON(data, {
                            filter: function (feature) {
                                const props = feature.properties;
                                const schoolName = props.SCHOOL_NAME || props.S_NAME ||
                                    props.HS_Name || props.NAME ||
                                    props.SchoolName || props.name || '';

                                const nameLower = schoolName.toLowerCase();

                                // Excluir escuelas no high schools
                                if (nameLower.includes('elementary') ||
                                    nameLower.includes('middle') ||
                                    nameLower.includes('pre-k')) {
                                    return false;
                                }

                                // IMPORTANTE: Solo mostrar boundaries de escuelas que existen en nuestro array
                                const schoolData = findSchoolRating(schoolName);

                                if (!schoolData) {
                                    console.log(`[FILTRADO] Boundary sin escuela en array: ${schoolName}`);
                                    return false;
                                }

                                return true;
                            },
                            style: function (feature) {
                                const props = feature.properties;
                                const schoolName = props.SCHOOL_NAME || props.S_NAME ||
                                    props.HS_Name || props.NAME ||
                                    props.SchoolName || props.name || '';

                                const schoolData = findSchoolRating(schoolName);
                                const rating = schoolData ? schoolData.rating : 5;
                                const color = ratingColors[rating] || '#999';

                                return {
                                    fillColor: color,
                                    weight: 3,
                                    opacity: 1,
                                    color: color,
                                    fillOpacity: 0.5
                                };
                            },
                            onEachFeature: function (feature, layer) {
                                const props = feature.properties;
                                const schoolName = props.SCHOOL_NAME || props.S_NAME ||
                                    props.HS_Name || props.NAME ||
                                    props.SchoolName || props.name || 'Escuela desconocida';

                                const schoolData = findSchoolRating(schoolName);

                                if (schoolData) {
                                    schoolsWithOfficialBoundaries.add(schoolData.name.toLowerCase());
                                    boundariesInFile++;

                                    const color = ratingColors[schoolData.rating];

                                    const bounds = layer.getBounds();
                                    const center = bounds.getCenter();
                                    const marker = L.circleMarker(center, {
                                        radius: 8,
                                        fillColor: color,
                                        color: '#fff',
                                        weight: 2,
                                        opacity: 1,
                                        fillOpacity: 1,
                                        pane: 'markerPane'
                                    });

                                    const popupContent = `
                                        <div class="popup-title">${schoolData.name}</div>
                                        <div class="popup-rating" style="background-color: ${color}">
                                            ${schoolData.rating}/10
                                        </div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                                            ${getRatingDescription(schoolData.rating)}
                                        </div>
                                        <div class="popup-address">üìç ${schoolData.address}</div>
                                        <div class="popup-jurisdiction">üèõÔ∏è ${schoolData.jurisdiction}</div>
                                        <div style="margin-top: 5px; font-size: 10px; color: #1a9850; font-weight: bold;">
                                            ‚úì Boundary oficial de attendance zone
                                        </div>
                                    `;

                                    layer.bindPopup(popupContent);
                                    marker.bindPopup(popupContent);

                                    // Guardar color original y conectar marcador con pol√≠gono
                                    layer._originalColor = color;
                                    markerToPolygonMap.set(marker, layer);

                                    // Resaltar cuando se hace click en el marcador
                                    marker.on('click', function () {
                                        highlightPolygon(layer, color);
                                    });

                                    marker.addTo(allSchoolsLayer);
                                }
                            }
                        }).addTo(allSchoolsLayer);
                    }

                    totalBoundariesLoaded += boundariesInFile;
                    filesLoaded++;
                    console.log(`[OK] ${file}: ${boundariesInFile} boundaries cargados`);
                } catch (error) {
                    console.warn(`[ERROR] No se pudo cargar ${file}:`, error.message);
                    filesFailed++;
                }
            }

            console.log(`Total: ${totalBoundariesLoaded} boundaries oficiales cargados`);
            console.log(`Escuelas con boundaries oficiales:`, Array.from(schoolsWithOfficialBoundaries));

            // Ahora crear pol√≠gonos aproximados para las escuelas restantes
            createApproximateZones();

            console.log(`Zonas aproximadas creadas para ${highSchools.length - schoolsWithOfficialBoundaries.size} escuelas`);

            // Actualizar estado final
            if (totalBoundariesLoaded > 0) {
                statusDiv.className = 'success';
                statusTitle.innerHTML = '‚úì Boundaries cargados';
                statusDetails.innerHTML = `
                    <strong>${totalBoundariesLoaded} boundaries oficiales</strong><br>
                    ${filesLoaded} archivos GeoJSON cargados<br>
                    ${highSchools.length - schoolsWithOfficialBoundaries.size} zonas aproximadas
                `;
                // Ocultar despu√©s de 5 segundos
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            } else {
                statusDiv.className = 'error';
                statusTitle.innerHTML = '‚ö† Error al cargar boundaries';
                statusDetails.innerHTML = `
                    No se pudieron cargar los archivos GeoJSON.<br>
                    <strong>Soluci√≥n:</strong> Abre este archivo usando un servidor HTTP:<br>
                    <code>python -m http.server 8000</code><br>
                    Luego abre: <code>http://localhost:8000/index_with_boundaries.html</code>
                `;
            }
        }

        // Cargar boundaries al iniciar
        loadBoundaries();

        console.log('Mapa cargado con', highSchools.length, 'escuelas');
    </script>
</body>

</html>